# VOS WASH: Instructions for Building Android APK from Web App

This guide provides a comprehensive walkthrough for packaging the VOS WASH React web application into a native Android application using Android Studio. The primary method involves using a WebView to render the web content while integrating native Android features for a seamless user experience, such as handling file downloads into a dedicated folder.

## Prerequisites

Before you begin, ensure you have the following software installed:
1.  **Android Studio:** The latest stable version is recommended. (Download from the official Android developer website).
2.  **Java Development Kit (JDK):** Android Studio usually bundles its own JDK, but having a system-wide installation is good practice.
3.  **Node.js and npm:** Required to build the production version of the React web app.

---

## Step 1: Prepare the React Web Application

First, you need to create an optimized, static build of the React application.

1.  Open your terminal or command prompt in the root directory of your React project.
2.  Run the build command:
    ```bash
    npm run build
    ```
3.  This command will generate a `dist` folder in your project's root. This folder contains the `index.html` file and all the necessary static JavaScript, CSS, and asset files for your application.

---

## Step 2: Create a New Android Studio Project

Now, you'll create the native Android shell that will contain your web app.

1.  Open Android Studio.
2.  Click on **New Project**.
3.  Select the **Empty Views Activity** template and click **Next**.
4.  Configure your project with the following details:
    *   **Name:** VOS WASH
    *   **Package name:** `com.voswash.adminapp` (or your preferred package name)
    *   **Save location:** Choose a directory for your Android project.
    *   **Language:** **Kotlin**
    *   **Minimum SDK:** **API 24: Android 7.0 (Nougat)**. This ensures broad device compatibility while supporting modern WebView features.
5.  Click **Finish**. Android Studio will set up and build the initial project structure.

---

## Step 3: Configure the Android Project

### 3.1. Copy Web Assets

1.  In the Android Studio project pane (usually on the left), switch from the `Android` view to the **Project** view.
2.  Navigate to `[YourProjectName]/app/src/main/`.
3.  Right-click on the `main` directory and select **New > Directory**. Name it **`assets`**.
4.  Now, open your file explorer and go to the `dist` folder of your React project.
5.  **Copy all the contents** inside the `dist` folder and paste them into the newly created `assets` directory in Android Studio.

### 3.2. Add WebView to the Layout

1.  In the `Android` view, navigate to `app > res > layout > activity_main.xml`.
2.  Switch to the "Code" or "Split" view.
3.  Remove the default `<TextView ... />` element.
4.  Add a `<WebView>` that fills the entire screen. Your `activity_main.xml` should look like this:

    ```xml
    <?xml version="1.0" encoding="utf-8"?>
    <androidx.constraintlayout.widget.ConstraintLayout
        xmlns:android="http://schemas.android.com/apk/res/android"
        xmlns:app="http://schemas.android.com/apk/res-auto"
        xmlns:tools="http://schemas.android.com/tools"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        tools:context=".MainActivity">

        <WebView
            android:id="@+id/webview"
            android:layout_width="0dp"
            android:layout_height="0dp"
            app:layout_constraintTop_toTopOf="parent"
            app:layout_constraintBottom_toBottomOf="parent"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintEnd_toEndOf="parent" />

    </androidx.constraintlayout.widget.ConstraintLayout>
    ```

### 3.3. Add Necessary Permissions

1.  Navigate to `app > manifests > AndroidManifest.xml`.
2.  Add the `INTERNET` permission inside the `<manifest>` tag, just before the `<application>` tag. This is essential for the WebView to function correctly.

    ```xml
    <uses-permission android:name="android.permission.INTERNET" />
    ```
   *Note: Using Android's `DownloadManager` to save to public directories like `Downloads` on modern Android versions (API 29+) does not require explicit `WRITE_EXTERNAL_STORAGE` permission, making the process smoother and more secure.*

---

## Step 4: Implement the WebView Logic in MainActivity.kt

This is the most critical step. You'll load the web app and configure the WebView to handle JavaScript, local storage, and file downloads.

1.  Open `MainActivity.kt` located in `app > java > com.voswash.adminapp`.
2.  Replace the entire content of the file with the code below. This code includes logic for:
    *   Loading the local web app.
    *   Enabling JavaScript and DOM Storage (for `localStorage`).
    *   Handling the device's back button to navigate WebView history.
    *   **Implementing a `DownloadListener` to save files into a "VOS_WASH" subfolder in the device's Downloads directory and notify the user upon completion.**

```kotlin
package com.voswash.adminapp

import android.app.DownloadManager
import android.content.Context
import android.net.Uri
import android.os.Bundle
import android.os.Environment
import android.webkit.URLUtil
import android.webkit.WebView
import android.webkit.WebViewClient
import android.widget.Toast
import androidx.activity.OnBackPressedCallback
import androidx.appcompat.app.AppCompatActivity
import java.io.File

class MainActivity : AppCompatActivity() {
    private lateinit var webView: WebView

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)

        webView = findViewById(R.id.webview)

        // Basic WebView client to open links within the app
        webView.webViewClient = WebViewClient()

        // Configure WebView settings for the React app
        webView.settings.apply {
            javaScriptEnabled = true  // Essential for React app to work
            domStorageEnabled = true  // Essential for localStorage persistence
            databaseEnabled = true
            allowFileAccess = true
        }

        // Set up the download listener to handle PDF/CSV generation
        webView.setDownloadListener { url, userAgent, contentDisposition, mimeType, _ ->
            val request = DownloadManager.Request(Uri.parse(url))
            request.setMimeType(mimeType)
            request.addRequestHeader("User-Agent", userAgent)
            request.setDescription("Downloading file...")

            // Guess the filename from the URL, content disposition, and MIME type
            val fileName = URLUtil.guessFileName(url, contentDisposition, mimeType)
            request.setTitle(fileName)
            
            // Allow the file to be scanned by MediaScanner so it appears in file managers
            request.allowScanningByMediaScanner()

            // Show a notification while downloading and after completion
            request.setNotificationVisibility(DownloadManager.Request.VISIBILITY_VISIBLE_NOTIFY_COMPLETED)

            // Define a subdirectory within the public "Downloads" folder for better organization
            val subfolder = "VOS_WASH"
            request.setDestinationInExternalPublicDir(Environment.DIRECTORY_DOWNLOADS, subfolder + File.separator + fileName)

            val dm = getSystemService(Context.DOWNLOAD_SERVICE) as DownloadManager
            dm.enqueue(request)
            
            Toast.makeText(applicationContext, "Download started...", Toast.LENGTH_LONG).show()
        }

        // Load your local React app from the assets folder
        webView.loadUrl("file:///android_asset/index.html")

        // Handle the back button press to navigate within the WebView
        onBackPressedDispatcher.addCallback(this, object : OnBackPressedCallback(true) {
            override fun handleOnBackPressed() {
                if (webView.canGoBack()) {
                    // If the WebView has a history, go back
                    webView.goBack()
                } else {
                    // Otherwise, perform the default back action (exit the app)
                    if (isEnabled) {
                        isEnabled = false
                        onBackPressedDispatcher.onBackPressed()
                    }
                }
            }
        })
    }
}
```

---

## Step 5: App Styling and Final Configuration

1.  **App Icon:**
    *   In the `Project` view, right-click the `app` directory and go to **New > Image Asset**.
    *   Use the Asset Studio to create adaptive launcher icons. You can use a high-resolution version of your logo as the source.

2.  **App Theme (Fullscreen):**
    *   To remove the top action bar and make your app fullscreen, go to `app > res > values > themes.xml`.
    *   Find the line `<style name="Theme.VOSWASH" parent="Theme.Material3.DayNight.DarkActionBar">`.
    *   Change the parent theme to `Theme.Material3.DayNight.NoActionBar`.
    *   You can also customize the status bar color in this file to match your app's branding.

---

## Step 6: Build and Test the Application

1.  Connect a physical Android device to your computer or set up an Android Emulator in Android Studio (via `Tools > Device Manager`).
2.  Click the **Run 'app'** button (green play icon) in the Android Studio toolbar.
3.  Select your target device.
4.  The app will build and install. Test thoroughly:
    *   Ensure the app loads and functions correctly.
    *   Test all navigation and data persistence (which uses `localStorage`).
    *   **Verify that creating and downloading an invoice or CSV successfully saves a file to the `Downloads/VOS_WASH/` folder on the device.**
    *   Check that a notification appears confirming the download.

---

## Step 7: Generate a Signed APK for Deployment

When you're ready to distribute your app, you need to create a signed, release-ready APK.

1.  In Android Studio, go to **Build > Generate Signed Bundle / APK**.
2.  Select **APK** and click **Next**.
3.  **Keystore:**
    *   If you don't have a keystore, click **Create new...**.
    *   Choose a path to save your keystore file (e.g., in a secure folder outside the project).
    *   Create strong passwords for the keystore and the key.
    *   Fill in the certificate information.
    *   **IMPORTANT: Back up this keystore file and store your passwords securely. You will need them to publish any future updates to your app.**
    *   If you already have a keystore, select it and enter your passwords.
4.  Click **Next**.
5.  **Build Variants:** Select **release**.
6.  **Signature Versions:** Keep both V1 and V2 checked for maximum compatibility.
7.  Click **Finish**.

Android Studio will build the signed APK. Once complete, you'll see a notification with a "locate" link. Clicking it will open your file explorer to the `app/release` directory, where you will find `app-release.apk`. This file is ready for distribution.
