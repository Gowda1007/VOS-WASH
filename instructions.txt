# VOS WASH: Step-by-Step Guide to Build the Android APK

This guide provides detailed instructions for packaging the VOS WASH React web application into a native Android APK. This process involves using Android Studio to wrap the web app in a WebView component and implementing a native bridge to enable features like sharing PDFs directly to WhatsApp.

---

### Prerequisites

Before you begin, ensure you have the following software installed:
- **Node.js and npm:** For building the React application.
- **Android Studio:** The official IDE for Android development. Download the latest version.
- **An Android Emulator or Physical Device:** For testing the final application.

---

## Phase 1: Build the React Web Application

First, you need to create an optimized, static build of the React app.

1.  **Open a terminal** in the root directory of your web application project.
2.  **Install dependencies** by running:
    ```bash
    npm install
    ```
3.  **Create the production build**:
    ```bash
    npm run build
    ```
4.  This command creates a `dist` folder in your project directory. This folder contains the static HTML, CSS, and JavaScript files that will be embedded into the Android app.

---

## Phase 2: Create the Android Studio Project

Now, create a new Android project to act as the native container for your web app.

1.  **Open Android Studio** and select **"New Project"**.
2.  Choose the **"Empty Views Activity"** template and click **"Next"**.
3.  **Configure your project**:
    - **Name:** VOS WASH
    - **Package name:** `com.voswash.app` (or your preferred name)
    - **Language:** Kotlin
    - **Minimum SDK:** API 24: Android 7.0 (Nougat)
4.  Click **"Finish"**. Android Studio will set up and build the basic project structure.

---

## Phase 3: Integrate Web App & Implement Native Bridge

This is the core phase where you embed the web app and connect it to native Android features.

### Step 3.1: Add Web Assets to the Project

1.  In Android Studio, switch the file explorer view from "Android" to **"Project"**.
2.  Navigate to `VOS WASH/app/src/main/`.
3.  Right-click the `main` folder and select **New > Directory**. Name it `assets`.
4.  **Copy the entire contents** of your React project's `dist` folder and paste them directly into the new `app/src/main/assets` directory.

### Step 3.2: Configure the WebView Layout

1.  Open `app/src/main/res/layout/activity_main.xml`.
2.  Replace the entire content of the file with the following XML to make the WebView fill the screen:
    ```xml
    <?xml version="1.0" encoding="utf-8"?>
    <WebView xmlns:android="http://schemas.android.com/apk/res/android"
        xmlns:tools="http://schemas.android.com/tools"
        android:id="@+id/webview"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        tools:context=".MainActivity" />
    ```

### Step 3.3: Add Permissions and FileProvider

1.  Open `app/src/main/AndroidManifest.xml`.
2.  Add the `INTERNET` permission inside the `<manifest>` tag, just before the `<application>` tag:
    ```xml
    <uses-permission android:name="android.permission.INTERNET" />
    ```
3.  Inside the `<application>` tag, add the `FileProvider` definition. This is required for securely sharing files with other apps.
    ```xml
    <provider
        android:name="androidx.core.content.FileProvider"
        android:authorities="${applicationId}.provider"
        android:exported="false"
        android:grantUriPermissions="true">
        <meta-data
            android:name="android.support.FILE_PROVIDER_PATHS"
            android:resource="@xml/file_paths" />
    </provider>
    ```

4.  Create the `file_paths.xml` file. Right-click the `app/src/main/res` folder and select **New > Directory**. Name it `xml`.
5.  Right-click the new `xml` directory and select **New > XML Resource File**. Name the file `file_paths`.
6.  Paste the following content into `file_paths.xml`:
    ```xml
    <?xml version="1.0" encoding="utf-8"?>
    <paths>
        <cache-path name="shared_pdfs" path="." />
    </paths>
    ```

### Step 3.4: Load the Web App and Create the Bridge in MainActivity.kt

1.  Open `app/src/main/java/com/voswash/app/MainActivity.kt`.
2.  Replace the entire content of the file with the following Kotlin code. This code loads your web app, handles the back button for web navigation, and defines the `AndroidBridge` that your web app will call.

    ```kotlin
    package com.voswash.app

    import android.annotation.SuppressLint
    import android.content.ActivityNotFoundException
    import android.content.Context
    import android.content.Intent
    import android.net.Uri
    import android.os.Bundle
    import android.util.Base64
    import android.webkit.JavascriptInterface
    import android.webkit.WebChromeClient
    import android.webkit.WebView
    import android.webkit.WebViewClient
    import android.widget.Toast
    import androidx.activity.OnBackPressedCallback
    import androidx.appcompat.app.AppCompatActivity
    import androidx.core.content.FileProvider
    import java.io.File
    import java.io.FileOutputStream

    class MainActivity : AppCompatActivity() {
        private lateinit var webView: WebView

        @SuppressLint("SetJavaScriptEnabled")
        override fun onCreate(savedInstanceState: Bundle?) {
            super.onCreate(savedInstanceState)
            setContentView(R.layout.activity_main)

            webView = findViewById(R.id.webview)

            // IMPORTANT: Enable web contents debugging. This allows you to use Chrome DevTools
            // to inspect the WebView content and troubleshoot issues like the blank white screen.
            // Go to chrome://inspect in your desktop Chrome browser.
            WebView.setWebContentsDebuggingEnabled(true)

            // Configure WebView settings for a modern web app
            webView.settings.javaScriptEnabled = true
            webView.settings.domStorageEnabled = true
            webView.settings.allowFileAccess = true
            webView.settings.allowFileAccessFromFileURLs = true
            webView.settings.allowUniversalAccessFromFileURLs = true

            // Set clients to handle page loading, JS alerts, etc. This improves stability.
            webView.webViewClient = WebViewClient()
            webView.webChromeClient = WebChromeClient()

            // Add the JavaScript interface, naming it "AndroidBridge" for the web app to use
            webView.addJavascriptInterface(WebAppInterface(this), "AndroidBridge")

            // Load the local index.html file
            webView.loadUrl("file:///android_asset/index.html")

            // Handle the back button to navigate in WebView history
            onBackPressedDispatcher.addCallback(this, object : OnBackPressedCallback(true) {
                override fun handleOnBackPressed() {
                    if (webView.canGoBack()) {
                        webView.goBack()
                    } else {
                        // If there's no history, proceed with default back button action (exit app)
                        isEnabled = false
                        onBackPressedDispatcher.onBackPressed()
                    }
                }
            })
        }

        /**
         * The class that provides the interface for JavaScript to call native Android code.
         */
        class WebAppInterface(private val context: Context) {
            @JavascriptInterface
            fun sharePdfViaWhatsApp(base64Pdf: String, fileName: String, message: String, phoneNumber: String) {
                try {
                    // 1. Decode Base64 string to a PDF file
                    val pdfBytes = Base64.decode(base64Pdf, Base64.DEFAULT)
                    val file = File(context.cacheDir, fileName)
                    FileOutputStream(file).use { it.write(pdfBytes) }

                    // 2. Get a content URI using FileProvider
                    val fileUri: Uri = FileProvider.getUriForFile(
                        context,
                        "${context.packageName}.provider",
                        file
                    )

                    // 3. Create the share intent
                    val shareIntent = Intent(Intent.ACTION_SEND).apply {
                        // Set the target package to WhatsApp
                        setPackage("com.whatsapp")
                        type = "application/pdf"
                        putExtra(Intent.EXTRA_STREAM, fileUri)
                        putExtra(Intent.EXTRA_TEXT, message)
                        
                        // Pre-fill the contact number
                        // The number must be in the format countrycodephonenumber@s.whatsapp.net
                        putExtra("jid", "$phoneNumber@s.whatsapp.net")

                        addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION)
                    }

                    // 4. Start the WhatsApp activity
                    context.startActivity(shareIntent)

                } catch (e: ActivityNotFoundException) {
                    // Handle case where WhatsApp is not installed
                    (context as? AppCompatActivity)?.runOnUiThread {
                        Toast.makeText(context, "WhatsApp is not installed.", Toast.LENGTH_SHORT).show()
                    }
                } catch (e: Exception) {
                    e.printStackTrace()
                    (context as? AppCompatActivity)?.runOnUiThread {
                         Toast.makeText(context, "Failed to share PDF: ${e.message}", Toast.LENGTH_LONG).show()
                    }
                }
            }
        }
    }
    ```

### Step 3.5: Verify Gradle Dependencies (CRITICAL)

The Kotlin code requires several core Android libraries. If they are missing, the build will fail.

1.  Open `app/build.gradle.kts` (or `app/build.gradle`).
2.  Ensure the `dependencies` block contains the following lines. Add them if they are missing.

    ```kotlin
    dependencies {
        implementation("androidx.core:core-ktx:1.13.1")
        implementation("androidx.appcompat:appcompat:1.7.0")
        implementation("com.google.android.material:material:1.12.0")
        implementation("androidx.constraintlayout:constraintlayout:2.1.4")
        // Other dependencies...
    }
    ```
3.  A yellow bar will appear at the top of the editor. Click **"Sync Now"** to download and apply the changes.

---

## Phase 4: Final Configuration and APK Generation

### Step 4.1: Set the App Icon

1.  In the Project view, right-click the `app/src/main/res` folder.
2.  Select **New > Image Asset**.
3.  In the Asset Studio, choose your icon source (e.g., an image file) and adjust the settings to generate all necessary launcher icon sizes. Click **"Next"** then **"Finish"**.

### Step 4.2: Set the App Theme (CRITICAL)

To prevent the app from crashing on launch, you must use a compatible `AppCompat` theme.

1.  Open `app/src/main/res/values/themes.xml`.
2.  Replace the **entire content** of the file with the following code. This sets a full-screen theme without the default action bar.
    ```xml
    <resources xmlns:tools="http://schemas.android.com/tools">
      <!-- Base application theme. -->
      <style name="Base.Theme.VOSWASH" parent="Theme.AppCompat.DayNight.NoActionBar">
        <!-- Customize your light theme here. -->
        <!-- <item name="colorPrimary">@color/my_light_primary</item> -->
      </style>

      <style name="Theme.VOSWASH" parent="Base.Theme.VOSWASH" />
    </resources>
    ```

### Step 4.3: Generate the Signed APK

A signed APK is required for distribution and installation on devices.

1.  From the Android Studio menu bar, select **Build > Generate Signed Bundle / APK...**.
2.  Select **APK** and click **"Next"**.
3.  For the "Keystore", click **"Create new..."**.
4.  Choose a location to save your keystore file (e.g., in your project's root folder, but **do not commit it to version control**).
5.  Fill in the passwords and the certificate information. **Store these credentials securely**, as you'll need them to publish updates.
6.  Click **"OK"**.
7.  Back in the "Generate Signed APK" dialog, ensure your newly created keystore is selected, enter the passwords.
8.  Click **"Next"**.
9.  Select the **`release`** build variant and click **"Finish"**.

Android Studio will build the app, and a notification will appear when it's done. Click "locate" to find your signed `app-release.apk` file in the `VOS WASH/app/release/` directory. You can now install this file on any Android device.